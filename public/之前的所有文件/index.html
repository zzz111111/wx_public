<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>分享标题</title>
  <style>
    .img_wrap img {
      width: 100%;
    }
  </style>
</head>

<body>
  <h1>Index文件</h1>

  <div>
    <h2>照相机选择图片</h2>
    <input type="file" value="点击" class="cameraClick" accept="image/*" capture="camera">
    <input type="file" value="点击" class="cameraClick" accept="image/*">
  </div>


  <h2 class="refresh">刷新当前页面</h2>
  <h1 class="saoyisao">点击调取扫一扫功能</h1>

  <h2 class="check_jsapi">检查jsapi</h2>

  <h2 class="share_qq">分享到qq朋友圈</h2>

  <h2 class="select_img">从手机相册中选取图片</h2>
  <div class="img_wrap">
    <p>图片容器</p>

  </div>
  <div>
    <h2 class="get_auth">请求获取网页授权</h2>
  </div>

  <div>
    <h2 class="get_auth11">静默请求获取网页授权</h2>
  </div>

  <div>
    <h2 class="upload_img">上传临时素材</h2>
  </div>

  <div>
    <h2>
      <a href="/word文档.docx">打开word文档</a>
    </h2>
  </div>

  <div>
    <h2 class="prePDF">
      单击预览pdf文档
    </h2>
  </div>


  <div>
    <h2>
      <a href="/木星移动应用平台-服务端.pdf">打开pdt</a>
    </h2>
  </div>




  <div id="insert">点击插入</div>

  <!-- <div >
    <iframe src='https://view.officeapps.live.com/op/view.aspx?src=https://wxgz.xiaoye121.com/word文档.docx' width='100%'
      height='100%' frameborder='1'>
    </iframe>
  </div> -->

  <!-- <script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script> -->
  <script src="js/js-sdk.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="/js/vconsole.min.js"></script>
  <!-- <script src="http://wechatfe.github.io/vconsole/lib/vconsole.min.js?v=3.3.0"></script> -->
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>


  <script>

    
    (function () {



      // 拿到当前的网址去请求 签名配置信息

      // console.log('请求的列表信息');
      // console.log(window.location.href.split('#')[0]);

      // let url = window.location.href.split('#')[0].split('//')[1];
      // console.log(url);


      axios({
        url: 'https://wxgz.xiaoye121.com/wx/signature',
        method: 'POST',
        data: {
          url: window.location.href.split('#')[0]
        }
      })
        .then(res => {
          console.log('请求成功');
          console.log(res.data.data.timestamp);
          console.log(res.data.data.noncestr);
          console.log(res.data.data.signature);

          console.log(res);
          if (res.data.status === 200) {
            // 配置信息
            wx.config({
              debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
              appId: 'wx5910ab0a942c1030', // 必填，公众号的唯一标识
              // appId: 'wx5910ab0a942c1030', // 必填，公众号的唯一标识
              timestamp: res.data.data.timestamp, // 必填，生成签名的时间戳
              nonceStr: res.data.data.noncestr, // 必填，生成签名的随机串
              signature: res.data.data.signature,// 必填，签名
              jsApiList: ['scanQRCode', 'chooseImage', 'updateAppMessageShareData', 'uploadImage', 'previewFile'] // 必填，需要使用的JS接口列表
            });
          }
        })
        .catch(err => {
          console.log(err);
          console.log('请求失败');
        });

      wx.ready(function () {
        // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
        console.log('调用成功了啊');
      });

    })();
  </script>

  <script>
    // 打开调试面板
    var vConsole = new VConsole();


    (function () {


      // 点击插入
      $('#insert').on('click', function () {

      });

      // 刷新当前页面
      $('.refresh').on('click', function () {
        console.log('刷新当前页面');
        window.history.go(0);
      });


      // h5相机
      $('.cameraClick').on('change', function(e){
        console.log('相机时间', e)
        console.log(e.target.files[0]);
      });




      // 调取微信扫一扫功能
      document.querySelector('.saoyisao').addEventListener('click', function () {
        console.log('点击了微信扫一扫');
        wx.scanQRCode({
          needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
          scanType: ["qrCode", "barCode"], // 可以指定扫二维码还是一维码，默认二者都有
          success: function (res) {
            var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
            console.log('扫描结果');
            console.log(result);
          }
        });
      });

      // 检查js授权功能
      document.querySelector('.check_jsapi').addEventListener('click', function () {
        console.log('点击的检测授权api');
        wx.checkJsApi({
          jsApiList: ['chooseImage', 'scanQRCode'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
          success: function (res) {
            // 以键值对的形式返回，可用的api值true，不可用为false
            // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
            console.log('检测结果');
            console.log(res);
          }
        });

      });


      // 自定义分享给朋友及分享到QQ按钮的分享内容
      document.querySelector('.share_qq').addEventListener('click', function () {
        console.log('分享到qq空间');

        wx.ready(function () {   //需在用户可能点击分享按钮前就先调用
          wx.updateAppMessageShareData({
            title: '公众号', // 分享标题
            desc: '这是我的公众号第一次检测分享接口API', // 分享描述
            link: 'https://wxgz.xiaoye121.com', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
            imgUrl: 'https://wxgz.xiaoye121.com/img/1.png', // 分享图标
            success: function () {
              // 设置成功
              console.log('设置成功');
            }
          })
        });

        wx.onMenuShareAppMessage({
          title: '这是一个测试的标题--百度',
          desc: '这个是要分享内容的一些描述--百度一下，你就知道',
          link: 'https://www.xiaoye121.com',
          imgUrl: 'https://wxgz.xiaoye121.com/img/1.png',
          trigger: function (res) {
            // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
          },
          success: function (res) {
            alert('分享给朋友成功');
          },
          cancel: function (res) {
            alert('你没有分享给朋友');
          },
          fail: function (res) {
            alert(JSON.stringify(res));
          }
        });

      });

      var uploadLocalIds = [];
      $('.upload_img').on('click', function () {
        console.log('调取了上传临时素材接口');
        wx.uploadImage({
          localId: uploadLocalIds, // 需要上传的图片的本地ID，由chooseImage接口获得
          isShowProgressTips: 1, // 默认为1，显示进度提示
          success: function (res) {
            console.log('上传了吗');
            console.log('上传结果');
            console.log(res)
            var serverId = res.serverId; // 返回图片的服务器端ID
            $.ajax({
              url: 'https://wxgz.xiaoye121.com/wx/upload_media_id',
              type: 'POST',
              data: {
                media_id: serverId
              }
            })
          }
        });
      });


      // 点击使用pdf文档
      $('.prePDF').on('click', function () {
        console.log('点击了pdf文档');
        wx.previewFile({
          url: 'https://wxgz.xiaoye121.com/木星移动应用平台-服务端.pdf', // 需要预览文件的地址(必填，可以使用相对路径)
          name: '木星移动应用平台', // 需要预览文件的文件名(不填的话取url的最后部分)
          size: 1048576 // 需要预览文件的字节大小(必填)
        });
      });

      // 从手机相册中选取图片
      $('.select_img').on('click', function () {
        console.log('从手机相册中选择图片');
        wx.chooseImage({
          // count: 1, // 默认9
          sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
          sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
          success: function (res) {
            var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
            uploadLocalIds = localIds;
            console.log('选择的东西是什么');
            console.log(res);
            var str = "";
            for (var i = 0; i < localIds.length; i++) {
              str += '<img src=' + localIds[i] + ' />'
            }
            $('.img_wrap').html($('.img_wrap').html() + str);

            // 重新去获取图片 然后执行事件
            $('.img_wrap img').on('click', function (e) {
              console.log('打印一下地址');
              console.log(e.target.src);
              let http = e.target.src;
              // 调取预览接口看看可以吗
              wx.previewImage({
                current: http, // 当前显示图片的http链接
                urls: [http] // 需要预览的图片http链接列表
              });
            });
          }
        });
      });


      // 请求获取网页授权
      $('.get_auth').on('click', function () {
        console.log('调取网页授权');
        let redirectUrl = encodeURIComponent('https://wxgz.xiaoye121.com/wx/auth');

        window.location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx5910ab0a942c1030&redirect_uri=${redirectUrl}&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect`;
      });


      $('.get_auth11').on('click', function () {
        let redirectUrl = encodeURIComponent('https://wxgz.xiaoye121.com/wx/auth');
        console.log('通过ajax获取用户信息');
        let url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx5910ab0a942c1030&redirect_uri=${redirectUrl}&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect`;
        $.ajax({
          url: url,
          success(res) {
            console.log(res);
          },
          error(err) {
            console.log(err);
          }
        })
        // window.location.href = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx5910ab0a942c1030&redirect_uri=${redirectUrl}&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect`;
      });
    })();







  </script>
</body>

</html>